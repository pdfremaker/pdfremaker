{% extends "base.html" %}

{% block title %}処理結果 - PDF Remaker{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/page_result.css') }}">
<style>
  #debug-section { display: none; } /* 最初は非表示 */
</style>
{% endblock %}

{% block content %}
<div class="container">
  <h2>処理完了！</h2>

  <div class="info">
    <p><strong>処理対象ファイル:</strong> {{ pdf_name }}</p>
    <p><strong>保存先フォルダ:</strong> {{ dir_name }}</p>
  </div>

  {{ download_html | safe }}

  <section class="pdf-preview">
    <div style="display:flex;align-items:center;justify-content:space-between;">
      <h2>📄 出力PDFプレビュー</h2>
      <label style="font-weight:bold;">
        <input type="checkbox" id="debugToggle"> DEBUGモード
      </label>
    </div>

    {% if recreated_pdf_url %}
      <iframe src="{{ url_for('serve_output_file', filepath=recreated_pdf_url) }}" width="100%" height="700px"
              style="border:1px solid #ccc;border-radius:8px;"></iframe>
    {% else %}
      <div class="alert">再構成されたPDFが存在しないためプレビューできません。</div>
    {% endif %}
  </section>

  <div id="debug-section">
    <details>
      <summary>スタイル付き NEOテキスト</summary>
      <div class="styled-content-box">{{ styled_neo_html | safe }}</div>
    </details>

    <details>
      <summary>NEOテキスト (タグ付き)</summary>
      <div class="content-box">{{ neo_content }}</div>
    </details>

    <details>
      <summary>OGテキスト (タグ付き)</summary>
      <div class="content-box">{{ og_tagged_content }}</div>
    </details>

    <details>
      <summary>時系列ソート</summary>
      <div class="content-box">{{ sorted_content }}</div>
    </details>

    <details open>
      <summary>抽出画像 ({{ imgs|length }}枚)</summary>
      <div class="image-gallery">{{ image_gallery_html | safe }}</div>
    </details>
  </div>

  <a href="/" class="action-link back-link">別のファイルを処理する</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggle = document.getElementById("debugToggle");
  const section = document.getElementById("debug-section");

  // チェック切り替えでdebugセクションの表示/非表示
  toggle.addEventListener("change", () => {
    section.style.display = toggle.checked ? "block" : "none";
  });
});
</script>
{% endblock %}